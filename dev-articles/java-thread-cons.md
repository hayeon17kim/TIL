# 자바 Thread 문제점

작업마다 자바 스레드를 생성하는 정책은 상용 서비스에서 사용하기에는 무리가 있다. 다음과 같은 문제점이 있기 때문이다.

## 라이브 사이클

- 자바 스레드를 생성하고 제거하는 작업에도 자원이 소모된다. 따라서 클라이언트의 요청을 처리할 때 기본적인 딜레이가 생긴다.



## 자원 낭비

- 시스템의 자원, 특히 메모리를 소모한다.
- 하드웨어에 실제로 장착된 프로세서보다 많은 Java Thread가 만들어져 동작 중이라면 실제로 대부분의 자바 스레드가 대기(idle) 상태에 머무른다.
- 대기 상태에 머무르는 자바 스레드가 많아지면 메모리가 필요하고, JVM의 가비지 콜렉터에 가해지는 부하가 늘어나며, CPU를 사용하기 위해 여러 자바 스레드가 경쟁하여 메모리 이외에도 많은 자원을 소모한다.
- 만약 시스템에 꽂혀 있는 CPU에 개수에 해당하는 스레드가 동작 중이라면, Java Thread를 더 만들어낸다 하더라도 성능 개선은 커녕 악영향을 미칠 수 있다.



## 안정성

- 모든 시스템에는 생성할 수 있는 Java Thread의 개수가 제한되어 있다.
- 제한 개수는 플랫폼과 운영체제, JVM을 실행할 때 지정하는 인자나 Thread 클래스에 필요한 스택에 크기에 따라 달라진다.
- 제한된 양을 모두 사용하면 OutOfMemoryError가 발생한다. 이 에러가 발생한 상황에서는 오류를 바로잡을 수 없으며, 할 수 있다고 해도 안정적으로 처리하기가 어렵다. 따라서 프로그램이 제한된 값 안에서 동작하도록 작성해 OutOfMemoryError가 발생하지 않도록 미리 방지하는 것이 좋다. 
- 즉, 일정 수준까지는 Java Thread를 추가로 만들어 성능상의 이점을 얻을 수 있지만 특정 수준을 넘어간다면 성능이 떨어지고, 급기야 어플리케이션이 다운 될 수도 있다.
- 이런 상황을 방지하기 위해 Java Thread의 수에 제한을 두는 것이 현명하다.



## 자바 스레드 32비트 시스템

- 자바 코드와 네이티브 코드를 실행할 수 있도록 모든 Java Thread는 두 개의 스텍을 갖는다. 디폴트로 두 개의 스텍을 더한 용량이 0.5MB 정도 되지만, 이 값은 JVM 실행 시 -Xss 옵션이나 Thread 객체 생성자 파라미터로 지정할 수 있다.
- 자바 스레드별 스텍 크기를 2의 32승으로 나눈 값으로 설정하면, 수천 수만 개의 Java Thread를 사용할 수 있다.

