## 배달의민족 앱에 적용된 오프라인 모드에 대하여

### 오프라인 모드란?

앱을 **서버 응답이 없는 상황**에서도 **사용**할 수 있게 만든 기능이다. Google Map, Youtube에도 구현되어 있는 기능으로, 해외에 나가거나 장시간 네트워크 없이 활동하는 순간에 앱을 이용할 수 있게 만들어주는 기능이다.

### 기능의 목적

서비스 운영 장애 상황을 대비해 최소한의 안전망으로 오프라인 모드를 구현하고자 하였다. 서버의 응답이 없어도 **가장 최근에 서버로부터 받아온 데이터를 기반으로 화면을 구성**하여 사용자로 하여금 최소한의 기능을 사용할 수 있도록 한다.

### 기본 동작 로직

일차적으로 정상적인 API 응답을 앱 클라이언트 내부에 저장한다.

- User가 App에 화면을 요청한다.
- App은 서버(Server API)에 요청을 한다.
- 서버(Server API)가 정상 응답한다.
- App은 User 화면을 갱신한다.
- App은 Local Cache를 갱신한다.

API 응답이 비정상적으로 오는 경우 저장된 API 응답을 이용하여 화면에 출력한다.

- User가 App에 화면을 요청한다.
- App은 서버(Server API)에 요청을 한다.
- 서버(Server API)의 응답 타임아웃
- Local Cache를 이용해 User 화면을 갱신한다.

### 오프라인 모드 적용기

#### 1차 적용

장애상황에도 전화 주문은 가능하도록 적용

1. 앱 시작 시에 **API 응답이 없는 경우**에도 **앱 진입이 가능**하도록 **호출 API마다 정책을 정하여 메인까지 진입할 수 있도록 작업**
2. 메인 이후에서 화면들에서 주문을 하기 위해 **최소한으로 동작해야 하는 기능을 정의하고 구현**. **가게 진입까지 도움을 주는 API만 캐싱**
3. **앱에 저장되는 데이터**는 앱에서 **배달 주소가 변경**되면 **메인화면, 가게목록 데이터도 변경**되기 때문에 **배달 주소를 기준으로 저장**
4. 가게 상세 데이터의 경우 기존에 방문한 가게들만 보여주게 되면 일부 가게만 보여지게 되어 기능이 제한적이기 때문에 **가게 목록에서 제공하는 데이터를 기반으로 상세 화면을 보여주는 방식으로 개발**

#### 2차 적용

사용자 친화적으로 고도화하는 작업

- 배민 라이더스 목록에도 적용
- 광고 상품 표시:  서버로부터 광고상품 만료시간을 받아서 오프라인 모드가 동작하는 시점에 광고 중인 가게는 광고 목록에 표시될 수 있도록 변경 
- 메뉴 정보도 표시: 메뉴 데이터가 저장되어 있다면 메뉴 정보가 나올 수 있도록 변경
- 오프라인 상태 안내 UI: 오프라인 모드 동작 시에 현재 상태를 사용자가 알 수 있도록 안내하는 UI

### 효과

- 정상 상황과 거의 비슷하게 사용자가 앱을 사용해 주문
- 장애를 대응하기 위한 시간을 확보

