---
title: "π’» HTTP #9: HTTP μ»¨ν…μΈ  ν‘μƒ"
categories: network
tags: [ network, http ]
---

# HTTP μ»¨ν…μΈ  ν‘μƒ

Content Negotiationμ΄λ€ λ™μΌν• URIμ—μ„ λ¦¬μ†μ¤μ μ„λ΅ λ‹¤λ¥Έ λ²„μ „μ„ μ§€μ›ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ” λ©”μ»¤λ‹μ¦μ΄λ‹¤. μ‚¬μ©μ μ—μ΄μ „νΈκ°€ μ‚¬μ©μμ—κ² μ μΌ μ λ§λ” κ²ƒμ΄ λ¬΄μ—‡μΈμ§€ λ…μ‹ν•  μ μλ‹¤.

## μ›μΉ™

ν΄λΌμ΄μ–ΈνΈλ” λ¦¬μ†μ¤μ URLμ„ μ‚¬μ©ν•΄ λ¦¬μ†μ¤λ¥Ό μ”μ²­ν•λ‹¤. μ„λ²„λ” λ¦¬μ†μ¬λ¥Ό μ„ νƒν•κΈ° μ„ν•΄ μ΄λ° URLμ„ μ‚¬μ©ν•λ©° ν΄λΌμ΄μ–ΈνΈμ—κ² ν•΄λ‹Ή λ¦¬μ†μ¤μ νΉμ • ν”„λ μ  ν…μ΄μ…(λ¦¬μ†μ¤κ°€ μ κ³µν•λ” λ³€ν•)μ„ λ¦¬ν„΄ν•λ‹¤. 

λ¦¬μ†μ¤κ°€ URLμ„ ν†µν•΄ νΈμ¶λμ—μ„ λ• νΉμ • ν”„λ μ  ν…μ΄μ…μ„ μ„ νƒν•λ” λ°©λ²•μ€ Content Negotiationμ— μν•΄ κ²°μ •λλ‹¤. Content Negotiationμ€ μ„λ²„ μ£Όλ„μ™€ ν΄λΌμ΄μ–ΈνΈ μ£Όλ„λ΅ λ‚λ‰μ–΄μ§„λ‹¤. 

1. ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚΄λ” νΉμ • HTTP ν—¤λ”λ¥Ό μ΄μ©ν•λ” λ°©λ²• (μ„λ²„ μ£Όλ„)
2. μ „λ‹¬λ°›μ€ 300, 406 μƒνƒ μ½”λ“λ¥Ό μ‚¬μ©ν•λ” λ°©λ²• (μ—μ΄μ „νΈ μ£Όλ„)

![img](https://mdn.mozillademos.org/files/13789/HTTPNego.png)

## server-driven content negotiation

**ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚΄λ” νΉμ • HTTP ν—¤λ”λ¥Ό μ΄μ©**ν•λ” λ°©λ²•μΌλ΅, νΉμ • μΆ…λ¥μ λ¦¬μ†μ¤μ— λ€ν• **ν‘μ¤€ ν‘μƒ λ°©λ²•**μ΄λ‹¤. HTTP/1.1 ν‘μ¤€μ€ μ„λ²„ μ£Όλ„ ν‘μƒμ„ μ‹μ‘ν•λ” ν‘μ¤€ ν—¤λ” λ©λ΅([`Accept`](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Accept), [`Accept-Charset`](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Accept-Charset), [`Accept-Encoding`](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Accept-Encoding), [`Accept-Language`](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Accept-Language))μ„ μ •μν•κ³  μλ‹¤. 

![img](https://mdn.mozillademos.org/files/13791/HTTPNegoServer.png)



μ„λ²„ μ£Όλ„ Content Negotiationμ€ λ‹¤μκ³Ό κ°™μ€ λ‹¨μ μ΄ μ΅΄μ¬ν•λ‹¤.

- μ„λ²„λ” **ν΄λΌμ΄μ–ΈνΈμ μƒνƒμ— λ€ν•΄ μ™„λ²½ν μ•κ³  μμ§€ μ•κΈ° λ•λ¬Έμ—** μ„λ²„κ°€ μ„ νƒν• representationμ΄ ν΄λΌμ΄μ–ΈνΈμ—κ² μ ν•©ν•μ§€ ν™•μ‹ ν•  μ μ—†λ‹¤.
- ν΄λΌμ΄μ–ΈνΈ ν—¤λ”μ— μλ” μ •λ³΄λ” **μ‚¬μƒν™ μΉ¨ν•΄**κ°€ λ  μ μλ‹¤.
  - HTTP ν—¤λ” μ •λ³΄λ¥Ό λ³΄κ³  μ›κ²© μ»΄ν“¨ν„°μ OS, λ²„μ „, μ‚¬μ© μ¤‘μΈ ν”„λ΅ν† μ½μ„ μ•μ•„λ‚Ό μλ„ μλ‹¤.
- **μ£Όμ–΄μ§„ λ¦¬μ†μ¤μ λ‡ κ°μ representationμ΄ μ „μ†΅**λλ―€λ΅, μƒ¤λ“λ μΊμ‹λ“¤μ€ λ ν¨μ¨μ μ΄κ³  μ„λ²„ κµ¬ν„μ€ μΆ€ λ” λ³µμ΅ν•΄μ§„λ‹¤.

> μƒ¤λ“(shard): λ‹¨μΌμ λ°μ΄ν„°λ¥Ό μ΅°κ°λ‚΄μ–΄ λ‚λ„λ” κ²ƒμ„ λ§ν•λ‹¤.

### `Accept` ν—¤λ”

- μ—μ΄μ „νΈκ°€ μ²λ¦¬ν•κ³ μ ν•λ” λ―Έλ””μ–΄ λ¦¬μ†μ¤μ ν’μ§ μΈμμ™€ ν•¨κ» **MIME νƒ€μ…μ„ λ‚μ—΄**ν• ν—¤λ”
- λ‹¤λ¥Έ MIME νƒ€μ… μ‚¬μ΄μ μƒλ€μ μΈ μ„ νΈλ„λ¥Ό λ‚νƒ€λ‚Έλ‹¤.

### `Accept-Charset` ν—¤λ”

- ν΄λΌμ΄μ–ΈνΈκ°€ μ΄ν•΄ν•  μ μλ” λ¬Έμ μΈμ½”λ”© νƒ€μ…μ„ λ‚νƒ€λ‚Έλ‹¤.
- μ „ν†µμ μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ μ„μΉμ— λ”°λΌ μ„λ΅ λ‹¤λ¥Έ κ°’μ„ μ„¤μ •ν•κΈ° μ„ν•΄ μ‚¬μ©λμ—λ‹¤.

- ν„μ¬λ” λ€λ¶€λ¶„μ λΈλΌμ°μ €λ“¤μ΄ `Accept-Charset` ν—¤λ”λ¥Ό μƒλµν•κ³  μλ‹¤. 
  - UTF-8μ λ³΄νΈν™”
  - κ°μΈμ •λ³΄μ λ³΄νΈ(ν΄λΌμ΄μ–ΈνΈμ μ •λ³΄λ¥Ό μµλ€ν• λ λ…Έμ¶μ‹ν‚¤κΈ° μ„ν•΄)

### `Accept-Encoding` ν—¤λ”

- ν΄λΌμ΄μ–ΈνΈκ°€ μμ©ν•  μ μλ” HTTP μ••μ¶• λ°©μ‹μ„ λ‚νƒ€λ‚Έλ‹¤.
- qμΈμλ¥Ό μ‚¬μ©ν•΄ μ••μ¶• λ°©μ‹ κ°„ μ°μ„ μμ„λ¥Ό λ‚νƒ€λ‚Έλ‹¤.
  - κΈ°λ³Έκ°’ `identity`λ” κ°€μ¥ λ‚®μ€ μ°μ„ μμ„μ΄λ‹¤.
- μ „μ†΅λλ” λ€μ—­ν­μ„ μ μ•½ν•  μ μλ” μΆ‹μ€ λ°©λ²•μΌλ΅, λΈλΌμ°μ €λ” ν•„μμ μΌλ΅ μ΄ ν—¤λ”λ¥Ό ν¬ν•¨μ‹μΌ μ”μ²­ν•λ‹¤. μ„λ²„λ” μ΄μ— λ”°λΌ μ••μ¶• λ°©λ²•μ„ μ‚¬μ©ν•  μ μμ–΄μ•Ό ν•λ‹¤.

### `Accept-Language` ν—¤λ”

- ν΄λΌμ΄μ–ΈνΈκ°€ μ„ νΈν•λ” μ–Έμ–΄ λ©λ΅μ„ λ‚νƒ€λ‚Έλ‹¤.
- qμΈμλ΅ μ–Έμ–΄ κ°„ μ„ νΈ μ°μ„ μμ„λ¥Ό λ‚νƒ€λ‚Έλ‹¤.
- λΈλΌμ°μ €λ” κΈ°λ³Έμ μΌλ΅ μ‚¬μ©μ μΈν„°νμ΄μ¤ μ–Έμ–΄ μ„¤μ •κ°’μ„ μ΄μ©ν•΄ Accept Language κ°’μ„ λ³΄λ‚Έλ‹¤.
- κ·Έλ¬λ‚ μ‚¬μ©μμ μ‹¤μ  μ”κµ¬μ™€ μ΄ κ°’μ€ λ¶μΌμΉν•  μλ„ μλ‹¤.
- λ”°λΌμ„ μ‚¬μ΄νΈμ— μ–Έμ–΄ λ©”λ‰΄λ¥Ό μ κ³µν•λ” λ“± μ΄μ— λ€λΉ„ν•  ν•„μ”κ°€ μλ‹¤.

### `User-Agent` ν—¤λ”

- μ”μ²­μ„ μ „μ†΅ν•λ” λΈλΌμ°μ €λ¥Ό λ‚νƒ€λ‚Έλ‹¤.
- product tokensμ™€ commentsκ°€ κ³µλ°±μΌλ΅ κµ¬λ¶„λ λ¬Έμμ—΄μ΄λ‹¤.
- product token: `λΈλΌμ°μ €/λ²„μ „`
- comment: κ΄„νΈ μ•μ— μ ν€ μμΌλ©° ν•΄λ‹Ή λΈλΌμ°μ €κ°€ μ†ν• νΈμ¤νΈμ OS λ“± μ •λ³΄κ°€ λ“¤μ–΄μλ‹¤.
- μ΄ ν—¤λ”μ— μμ§€ν•΄ λΈλΌμ°μ €λ§λ‹¤ μ›Ή νμ΄μ§€ λ° μ„λΉ„μ¤λ¥Ό μ κ³µν•λ” κ²ƒμ€ μΆ‹μ§€ μ•λ‹¤. μ›Ήμ€ μ‚¬μ©μκ°€ μ–΄λ–¤ λΈλΌμ°μ €λ‚ λ””λ°”μ΄μ¤λ¥Ό μ‚¬μ©ν•λ” μ§€μ— κ°μμΉ μ•κ³  λ¨λ‘μ—κ² μ ‘κ·Όμ΄ μ©μ΄ν•΄μ•Ό ν•κΈ° λ•λ¬Έμ΄λ‹¤.
- `Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36`

### `Vary` μ‘λ‹µ ν—¤λ”

- `Accept-*` ν—¤λ”μ™€ λ‹¬λ¦¬ μ›Ή μ„λ²„ μ‘λ‹µ ν—¤λ”μ΄λ‹¤. 

- μ„λ²„ μ£Όλ„ μ»¨ν…μΈ  ν‘μƒμ κ³Όμ • μ¤‘μ— μ„λ²„μ— μν•΄ μ‚¬μ©λλ” ν—¤λ”λ“¤μ λ©λ΅μ„ λ‚νƒ€λ‚Έλ‹¤.

- μ¦‰ ν΄λΌμ΄μ–ΈνΈκ°€ μ μ‹ν• μ—¬λ¬ representation μ¤‘μ—μ„ μ„λ²„κ°€ μ„ νƒν• ν—¤λ”κ°€ λ¬΄μ—‡μΈμ§€ μ•λ ¤μ¤€λ‹¤.
- μΊμ‹λ μ‘λ‹µμ„ μ‚¬μ©ν•  μ μλ” μ§€ κ²°μ •ν•λ” λ° μ‚¬μ©ν•λ‹¤.
- `Vary: <header-name>, <header-name>`

## agent-driven content negotiation

- server-driven content negotiation λ‹¨μ 
  - ν΄λΌμ΄μ–ΈνΈκ°€ μ •ν™•ν• μ •λ³΄λ¥Ό μ κ³µν•λ ¤ ν•λ©΄ λ” λ§μ€ ν—¤λ”κ°€ ν•„μ”ν•λ‹¤.
  - λ” λ§μ€ ν—¤λ”λ” λ€μ—­ν­μ μ¦κ°€μ™€ κ°μΈμ •λ³΄ λ…Έμ¶μ„ μ•ΌκΈ°ν•λ‹¤.
- μ΄μ— HTTPλ” agent-driven content negotiationμ„ μ§€μ›ν•λ‹¤. 
- μ„λ²„κ°€ μ• λ§¤ν• representation μ΅°κ±΄μ„ λ§μ£Όν–μ„ λ•, μ‚¬μ© κ°€λ¥ν• λ¦¬μ†μ¤λ“¤μ URLλ¥Ό ν¬ν•¨ν• νμ΄μ§€(300 multiple choices)λ¥Ό λ¦¬ν„΄ν•κ³ , μ΄μ— μ‚¬μ©μλ” μ‚¬μ©ν•κ³ μ ν•λ” λ¦¬μ†μ¤λ¥Ό μ„ νƒν•λ‹¤.

![img](https://mdn.mozillademos.org/files/13795/HTTPNego3.png)

**μ—μ΄μ „νΈ μ£Όλ„ ν‘μƒμ λ¬Έμ μ **

- HTTP ν‘μ¤€μ€ μ‚¬μ© κ°€λ¥ν• λ¦¬μ†μ¤ μ¤‘μ—μ„ μ„ νƒν•λ„λ΅ ν—μ©ν•λ” νμ΄μ§€μ ν•μ‹μ„ λ…μ‹ν•μ§€ μ•κ³  μλ‹¤.

- μ‹¤μ  λ¦¬μ†μ¤λ¥Ό κ°€μ Έμ¤λ”λ° ν• κ° μ΄μƒμ μ”μ²­μ΄ ν•„μ”ν•΄ λ¦¬μ†μ¤ ν¨μ©μ„±μ΄ λ–¨μ–΄μ§„λ‹¤.